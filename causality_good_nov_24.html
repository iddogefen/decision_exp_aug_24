<!DOCTYPE html>
<html>
  <head>
    <style>
      /* Optional: Hide cursor if needed */
      .hide_cursor {
        cursor: none;
      }
    </style>
    <title>My Experiment</title>
    <!-- Include jsPsych library and plugins -->
    <script src="jspsych/plugins/jspsych.js"></script>
    <script src="jspsych/plugins/plugin-instructions.js"></script>
    <script src="jspsych/plugins/plugin-html-button-response.js"></script>
    <script src="jspsych/plugins/plugin-preload.js"></script>
    <link rel="stylesheet" href="jspsych/css/jspsych.css">
  </head>
  <body></body>
  <script>
    // Define data folder for saving results
    var data_folder = 'data/';

    // Function to save data via POST request
    function saveData(name, data) {
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'write_data.php'); // PHP file to handle data writing
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify({ filedata: data }));
    }

    // Initialize jsPsych
    var jsPsych = initJsPsych({
      on_finish: function () {
        saveData(data_folder + 'all_data_sub_' + subject_id + '.csv', jsPsych.data.get().csv());
      }
    });

    // Generate a random subject ID
    var subject_id = jsPsych.randomization.randomID(15);

    // Initialize experiment timeline
    var timeline = [];

    // Preload images
    var preload = {
      type: jsPsychPreload,
      images: [
        'images/causal/package_causal/package_causal_1.png',
        'images/causal/package_causal/package_causal_2.png',
        'images/causal/package_causal/package_causal_3.png',
        'images/causal/package_causal/package_causal_4.png',
        'images/causal/package_causal/package_causal_5.png',
        'images/causal/package_causal/package_causal_6.png',
        'images/causal/package_causal/package_causal_7.png',
        'images/causal/package_causal/package_causal_8.png',
        'images/causal/package_causal/package_causal_9.png',
        'images/causal/package_causal/package_causal_10.png'
      ]
    };

    // Add preloading to timeline
    timeline.push(preload);

    // Generate all unique pairs for the causal images
    function generateUniquePairs(rangeStart, rangeEnd) {
      let pairs = [];
      for (let i = rangeStart; i <= rangeEnd; i++) {
        for (let j = i + 1; j <= rangeEnd; j++) {
          pairs.push([i, j]);
        }
      }
      return pairs;
    }

    let allPairs = generateUniquePairs(1, 10); // Pairs from 1 to 10
    let shuffledPairs = jsPsych.randomization.shuffle(allPairs); // Shuffle the pairs

    // Add causal trials dynamically
    shuffledPairs.forEach(pair => {
      timeline.push({
        type: jsPsychHtmlButtonResponse,
        stimulus: `
          <div style="display: flex; justify-content: center; align-items: center;">
            <!-- Event 1 on the left -->
            <div style="text-align: center; margin-right: 20px;">
              <p style="font-size: 24px; font-weight: bold;">Event 1</p>
              <img src="images/causal/package_causal/package_causal_${pair[0]}.png" style="width: 300px; height: auto;">
            </div>
            <!-- Event 2 on the right -->
            <div style="text-align: center; margin-left: 20px;">
              <p style="font-size: 24px; font-weight: bold;">Event 2</p>
              <img src="images/causal/package_causal/package_causal_${pair[1]}.png" style="width: 300px; height: auto;">
            </div>
          </div>
          <p style="text-align: center; margin-top: 20px;">Does Event 1 lead to Event 2?</p>`,
        choices: ['Event 1 leads to Event 2', 'Event 2 leads to Event 1', 'Events are unrelated'],
        on_finish: function (data) {
          data.firstImageNumber = pair[0];
          data.secondImageNumber = pair[1];
        }
      });
    });

    // Add final thank-you screen
    var trial_end = {
      type: jsPsychInstructions,
      pages: [
        '<h2>Thank you for participating!</h2>' +
        '<p>You have completed the experiment.</p>'
      ],
      show_clickable_nav: true
    };

    timeline.push(trial_end);

    // Run the experiment
    jsPsych.run(timeline);
  </script>
</html>
