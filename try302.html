<!DOCTYPE html>
<html>
  <head>
    <style>
      .hide_cursor {
        cursor: none;
      }
    </style>
    <title>My experiment</title>
    <script src="jspsych/plugins/jspsych.js"></script>
    <script src="jspsych/plugins/plugin-instructions.js"></script>
    <script src="jspsych/plugins/plugin-html-button-response.js"></script>
    <script src="jspsych/plugins/plugin-survey-text.js"></script>
    <script src="jspsych/plugins/plugin-html-keyboard-response.js"></script>
    <script src="jspsych/plugins/plugin-survey-likert.js"></script>
    <script src="jspsych/plugins/plugin-html-button-response.js"></script>
    <script src="jspsych/plugins/plugin-fullscreen.js"></script>
    <script src="jspsych/plugins/plugin-preload.js"></script>
    <link rel="stylesheet" href="jspsych/css/jspsych.css">
  </head>
  <body></body>
  <script>
    var data_folder = 'data/';

    function saveData(name, data){
      var xhr = new XMLHttpRequest();
      xhr.open('POST', 'write_data.php');
      xhr.setRequestHeader('Content-Type', 'application/json');
      xhr.send(JSON.stringify({filedata: data}));
    }

    var jsPsych = initJsPsych({
      on_finish: function() {
        saveData(data_folder+'All_data/all_data_sub_'+subject_id+".csv", jsPsych.data.get().csv());
      }
    });

    var timeline = [];

    // Adding subject properties
    var subject_id = jsPsych.data.getURLVariable('participantId');
    var study_id = jsPsych.data.getURLVariable('assignmentId');
    var session_id = jsPsych.data.getURLVariable('projectId');

    jsPsych.data.addProperties({
      subject_id: subject_id,
      study_id: study_id,
      session_id: session_id,
    });


// Preload images
var preload = {
  type: jsPsychPreload,
  images: [
    'consent_form_2022.png',
    'images/blue_deck_1.png',
    'images/red_deck_2.png',
    'images/causal/causal_series_1/causal_series_1_a.jpg',
    'images/causal/causal_series_1/causal_series_1_b.jpg',
    'images/causal/causal_series_1/causal_series_1_c.jpg',
    'images/causal/causal_series_1/causal_series_1_d.jpg',
    'images/causal/causal_series_2/causal_series_2_a.jpg',
    'images/causal/causal_series_2/causal_series_2_b.jpg',
    'images/causal/causal_series_2/causal_series_2_c.jpg',
    'images/causal/causal_series_2/causal_series_2_d.jpg',
    'images/causal/causal_series_3/causal_series_3_a.jpg',
    'images/causal/causal_series_3/causal_series_3_b.jpg',
    'images/causal/causal_series_3/causal_series_3_c.jpg',
    'images/causal/causal_series_3/causal_series_3_d.jpg',
    'images/causal/causal_series_4/causal_series_4_a.jpg',
    'images/causal/causal_series_4/causal_series_4_b.jpg',
    'images/causal/causal_series_4/causal_series_4_c.jpg',
    'images/causal/causal_series_4/causal_series_4_d.jpg',
    'images/causal/causal_series_5/causal_series_5_a.jpg',
    'images/causal/causal_series_5/causal_series_5_b.jpg',
    'images/causal/causal_series_5/causal_series_5_c.jpg',
    'images/causal/causal_series_5/causal_series_5_d.jpg',
    'images/causal/causal_series_6/causal_series_6_a.jpg',
    'images/causal/causal_series_6/causal_series_6_b.jpg',
    'images/causal/causal_series_6/causal_series_6_c.jpg',
    'images/causal/causal_series_6/causal_series_6_d.jpg',
    'images/causal/causal_series_7/causal_series_7_a.jpg',
    'images/causal/causal_series_7/causal_series_7_b.jpg',
    'images/causal/causal_series_7/causal_series_7_c.jpg',
    'images/causal/causal_series_7/causal_series_7_d.jpg',
    'images/causal/causal_series_8/causal_series_8_a.jpg',
    'images/causal/causal_series_8/causal_series_8_b.jpg',
    'images/causal/causal_series_8/causal_series_8_c.jpg',
    'images/causal/causal_series_8/causal_series_8_d.jpg',
    'images/causal/causal_series_9/causal_series_9_a.jpg',
    'images/causal/causal_series_9/causal_series_9_b.jpg',
    'images/causal/causal_series_9/causal_series_9_c.jpg',
    'images/causal/causal_series_9/causal_series_9_d.jpg',
    'images/causal/causal_series_10/causal_series_10_a.jpg',
    'images/causal/causal_series_10/causal_series_10_b.jpg',
    'images/causal/causal_series_10/causal_series_10_c.jpg',
    'images/causal/causal_series_10/causal_series_10_d.jpg',
    'images/causal/causal_series_11/causal_series_11_a.jpg',
    'images/causal/causal_series_11/causal_series_11_b.jpg',
    'images/causal/causal_series_11/causal_series_11_c.jpg',
    'images/causal/causal_series_11/causal_series_11_d.jpg',
    'images/causal/causal_series_12/causal_series_12_a.jpg',
    'images/causal/causal_series_12/causal_series_12_b.jpg',
    'images/causal/causal_series_12/causal_series_12_c.jpg',
    'images/causal/causal_series_12/causal_series_12_d.jpg',
    'images/causal/causal_series_13/causal_series_13_a.jpg',
    'images/causal/causal_series_13/causal_series_13_b.jpg',
    'images/causal/causal_series_13/causal_series_13_c.jpg',
    'images/causal/causal_series_13/causal_series_13_d.jpg',
    'images/causal/causal_series_14/causal_series_14_a.jpg',
    'images/causal/causal_series_14/causal_series_14_b.jpg',
    'images/causal/causal_series_14/causal_series_14_c.jpg',
    'images/causal/causal_series_14/causal_series_14_d.jpg',
    'images/causal/causal_series_15/causal_series_15_a.jpg',
    'images/causal/causal_series_15/causal_series_15_b.jpg',
    'images/causal/causal_series_15/causal_series_15_c.jpg',
    'images/causal/causal_series_15/causal_series_15_d.jpg',
    'images/causal/causal_series_16/causal_series_16_a.jpg',
    'images/causal/causal_series_16/causal_series_16_b.jpg',
    'images/causal/causal_series_16/causal_series_16_c.jpg',
    'images/causal/causal_series_16/causal_series_16_d.jpg',
    'images/causal/causal_series_17/causal_series_17_a.jpg',
    'images/causal/causal_series_17/causal_series_17_b.jpg',
    'images/causal/causal_series_17/causal_series_17_c.jpg',
    'images/causal/causal_series_17/causal_series_17_d.jpg',
    'images/causal/causal_series_18/causal_series_18_a.jpg',
    'images/causal/causal_series_18/causal_series_18_b.jpg',
    'images/causal/causal_series_18/causal_series_18_c.jpg',
    'images/causal/causal_series_18/causal_series_18_d.jpg',
    'images/semantic/semantic_series_1/semantic_series_1_d.jpg',
    'images/semantic/semantic_series_2/semantic_series_2_d.jpg',
    'images/semantic/semantic_series_3/semantic_series_3_d.jpg',
    'images/semantic/semantic_series_4/semantic_series_4_d.jpg',
    'images/semantic/semantic_series_5/semantic_series_5_d.jpg',
    'images/semantic/semantic_series_6/semantic_series_6_d.jpg',
    'images/semantic/semantic_series_7/semantic_series_7_d.jpg',
    'images/semantic/semantic_series_8/semantic_series_8_d.jpg',
    'images/semantic/semantic_series_9/semantic_series_9_d.jpg',
    'images/semantic/semantic_series_10/semantic_series_10_d.jpg',
    'images/semantic/semantic_series_11/semantic_series_11_d.jpg',
    'images/semantic/semantic_series_12/semantic_series_12_d.jpg',
    'images/semantic/semantic_series_13/semantic_series_13_d.jpg',
    'images/semantic/semantic_series_14/semantic_series_14_d.jpg',
    'images/semantic/semantic_series_15/semantic_series_15_d.jpg',
    'images/semantic/semantic_series_16/semantic_series_16_d.jpg',
    'images/semantic/semantic_series_17/semantic_series_17_d.jpg',
    'images/semantic/semantic_series_18/semantic_series_18_d.jpg'

  ]
};
timeline.push(preload);

// Define consent form and fullscreen start
var trial_0 = {
  type: jsPsychInstructions,
  pages: [
    '<div style="font-family: Arial; background: var(--grey); padding: 100px; padding-top: 5%; text-align: left;">' +
    '<h2>Thank you for participating in this experiment!</h2>' +
    '<p>By clicking the "Begin Study" button, you will be taken to the study, including complete instructions and an informed consent agreement.</p>'
  ],
  show_clickable_nav: true
};

var trial_consent = {
  type: jsPsychInstructions,
  pages: [
    '<div style="text-align:center; font-family:Arial; font-size: 22px; padding-top:20px;">' +
    '<p>Please carefully read the consent form below before proceeding.</p>' +
    '<img src="consent_form_2022.png" style="max-width:80%; padding:20px;"></img>' +
    '</div>'
  ],
  show_clickable_nav: true
};

var trial_01 = {
  type: jsPsychFullscreen,
  fullscreen_mode: true
};

timeline.push(trial_0, trial_consent, trial_01);


var instructions_deck_choice = {
  type: jsPsychInstructions,
  pages: [
    '<div style="font-family: Arial; text-align: left; padding: 100px; padding-top: 5%;">' +
    '<h2>Instructions</h2>' +
    '<p>In this experiment, you will view a series of three images at a time. Afterward, you will be asked to choose between two decks of cards: one <span style="color: blue;">blue</span> and one <span style="color: red;">red</span>.</p>' +
    '<p>Each deck contains a different type of cards.</p>' +
    '<p>Your task is to select the deck that appeals to you the most. Trust your intuition, there are no right or wrong choices, so simply follow your instincts.</p>' +
    '</div>'
  ],
  show_clickable_nav: true
};
timeline.push(instructions_deck_choice);




// Function to create a trial for each image
function createImageTrial(imagePath) {
  return {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<div style="display: flex; justify-content: center; align-items: center;">
                <img src="${imagePath}" style="width: 300px; height: 300px;" />
              </div>`,
    choices: "NO_KEYS",
    trial_duration: 3000
  };
}

// Define first three images for each series
var first_three_causal_1 = [
  createImageTrial('images/causal/causal_series_1/causal_series_1_a.jpg'),
  createImageTrial('images/causal/causal_series_1/causal_series_1_b.jpg'),
  createImageTrial('images/causal/causal_series_1/causal_series_1_c.jpg')
];
var first_three_causal_2 = [
  createImageTrial('images/causal/causal_series_2/causal_series_2_a.jpg'),
  createImageTrial('images/causal/causal_series_2/causal_series_2_b.jpg'),
  createImageTrial('images/causal/causal_series_2/causal_series_2_c.jpg')
];
// Repeat for all 18 causal series...
var first_three_causal_3 = [
  createImageTrial('images/causal/causal_series_3/causal_series_3_a.jpg'),
  createImageTrial('images/causal/causal_series_3/causal_series_3_b.jpg'),
  createImageTrial('images/causal/causal_series_3/causal_series_3_c.jpg')
];

var first_three_causal_4 = [
  createImageTrial('images/causal/causal_series_4/causal_series_4_a.jpg'),
  createImageTrial('images/causal/causal_series_4/causal_series_4_b.jpg'),
  createImageTrial('images/causal/causal_series_4/causal_series_4_c.jpg')
];


var first_three_causal_5 = [
  createImageTrial('images/causal/causal_series_5/causal_series_5_a.jpg'),
  createImageTrial('images/causal/causal_series_5/causal_series_5_b.jpg'),
  createImageTrial('images/causal/causal_series_5/causal_series_5_c.jpg')
];


var first_three_causal_6 = [
  createImageTrial('images/causal/causal_series_6/causal_series_6_a.jpg'),
  createImageTrial('images/causal/causal_series_6/causal_series_6_b.jpg'),
  createImageTrial('images/causal/causal_series_6/causal_series_6_c.jpg')
];


var first_three_causal_7 = [
  createImageTrial('images/causal/causal_series_7/causal_series_7_a.jpg'),
  createImageTrial('images/causal/causal_series_7/causal_series_7_b.jpg'),
  createImageTrial('images/causal/causal_series_7/causal_series_7_c.jpg')
];


var first_three_causal_8 = [
  createImageTrial('images/causal/causal_series_8/causal_series_8_a.jpg'),
  createImageTrial('images/causal/causal_series_8/causal_series_8_b.jpg'),
  createImageTrial('images/causal/causal_series_8/causal_series_8_c.jpg')
];

var first_three_causal_9 = [
  createImageTrial('images/causal/causal_series_9/causal_series_9_a.jpg'),
  createImageTrial('images/causal/causal_series_9/causal_series_9_b.jpg'),
  createImageTrial('images/causal/causal_series_9/causal_series_9_c.jpg')
];

var first_three_causal_10 = [
  createImageTrial('images/causal/causal_series_10/causal_series_10_a.jpg'),
  createImageTrial('images/causal/causal_series_10/causal_series_10_b.jpg'),
  createImageTrial('images/causal/causal_series_10/causal_series_10_c.jpg')
];

var first_three_causal_11 = [
  createImageTrial('images/causal/causal_series_11/causal_series_11_a.jpg'),
  createImageTrial('images/causal/causal_series_11/causal_series_11_b.jpg'),
  createImageTrial('images/causal/causal_series_11/causal_series_11_c.jpg')
];

var first_three_causal_12 = [
  createImageTrial('images/causal/causal_series_12/causal_series_12_a.jpg'),
  createImageTrial('images/causal/causal_series_12/causal_series_12_b.jpg'),
  createImageTrial('images/causal/causal_series_12/causal_series_12_c.jpg')
];

var first_three_causal_13 = [
  createImageTrial('images/causal/causal_series_13/causal_series_13_a.jpg'),
  createImageTrial('images/causal/causal_series_13/causal_series_13_b.jpg'),
  createImageTrial('images/causal/causal_series_13/causal_series_13_c.jpg')
];

var first_three_causal_14 = [
  createImageTrial('images/causal/causal_series_14/causal_series_14_a.jpg'),
  createImageTrial('images/causal/causal_series_14/causal_series_14_b.jpg'),
  createImageTrial('images/causal/causal_series_14/causal_series_14_c.jpg')
];

var first_three_causal_15 = [
  createImageTrial('images/causal/causal_series_15/causal_series_15_a.jpg'),
  createImageTrial('images/causal/causal_series_15/causal_series_15_b.jpg'),
  createImageTrial('images/causal/causal_series_15/causal_series_15_c.jpg')
];

var first_three_causal_16 = [
  createImageTrial('images/causal/causal_series_16/causal_series_16_a.jpg'),
  createImageTrial('images/causal/causal_series_16/causal_series_16_b.jpg'),
  createImageTrial('images/causal/causal_series_16/causal_series_16_c.jpg')
];

var first_three_causal_17 = [
  createImageTrial('images/causal/causal_series_17/causal_series_17_a.jpg'),
  createImageTrial('images/causal/causal_series_17/causal_series_17_b.jpg'),
  createImageTrial('images/causal/causal_series_17/causal_series_17_c.jpg')
];

var first_three_causal_18 = [
  createImageTrial('images/causal/causal_series_18/causal_series_18_a.jpg'),
  createImageTrial('images/causal/causal_series_18/causal_series_18_b.jpg'),
  createImageTrial('images/causal/causal_series_18/causal_series_18_c.jpg')
];



var clean_deck = [
  createImageTrial('images/other/blank.jpg')
];

// Next image choice task
var choose_next_image = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `
    <div style="display: flex; justify-content: center; align-items: center;">
      <img src="images/red_deck_2.png" style="width: 300px; height: 300px; margin-right: 10px;" />
      <img src="images/blue_deck_1.png" style="width: 300px; height: 300px;" />
    </div>`,
  choices: ['deck 1', 'deck 2'],
  on_finish: function(data) {
    data.choice = data.response;
  }
};

// Function to create a trial for the fourth image
function createFourthImageTrial(causalImagePath, semanticImagePath) {
  return {
    timeline: [
      {
        conditional_function: function() {
          var last_choice = jsPsych.data.getLastTrialData().values()[0].response;
          return last_choice == 0; // Causal image chosen
        },
        timeline: [createImageTrial(causalImagePath)]
      },
      {
        conditional_function: function() {
          var last_choice = jsPsych.data.getLastTrialData().values()[0].response;
          return last_choice == 1; // Semantic image chosen
        },
        timeline: [createImageTrial(semanticImagePath)]
      }
    ]
  };
}

// Create show_fourth_image trials
var show_fourth_image_1 = createFourthImageTrial('images/causal/causal_series_1/causal_series_1_d.jpg', 'images/semantic/semantic_series_18/semantic_series_18_d.jpg');
var show_fourth_image_2 = createFourthImageTrial('images/causal/causal_series_2/causal_series_2_d.jpg', 'images/semantic/semantic_series_1/semantic_series_1_d.jpg');
var show_fourth_image_3 = createFourthImageTrial('images/causal/causal_series_3/causal_series_3_d.jpg', 'images/semantic/semantic_series_2/semantic_series_2_d.jpg');
var show_fourth_image_4 = createFourthImageTrial('images/causal/causal_series_4/causal_series_4_d.jpg', 'images/semantic/semantic_series_3/semantic_series_3_d.jpg');
var show_fourth_image_5 = createFourthImageTrial('images/causal/causal_series_5/causal_series_5_d.jpg', 'images/semantic/semantic_series_4/semantic_series_4_d.jpg');
var show_fourth_image_6 = createFourthImageTrial('images/causal/causal_series_6/causal_series_6_d.jpg', 'images/semantic/semantic_series_5/semantic_series_5_d.jpg');
var show_fourth_image_7 = createFourthImageTrial('images/causal/causal_series_7/causal_series_7_d.jpg', 'images/semantic/semantic_series_6/semantic_series_6_d.jpg');
var show_fourth_image_8 = createFourthImageTrial('images/causal/causal_series_8/causal_series_8_d.jpg', 'images/semantic/semantic_series_7/semantic_series_7_d.jpg');
var show_fourth_image_9 = createFourthImageTrial('images/causal/causal_series_9/causal_series_9_d.jpg', 'images/semantic/semantic_series_8/semantic_series_8_d.jpg');
var show_fourth_image_10 = createFourthImageTrial('images/causal/causal_series_10/causal_series_10_d.jpg', 'images/semantic/semantic_series_9/semantic_series_9_d.jpg');
var show_fourth_image_11 = createFourthImageTrial('images/causal/causal_series_11/causal_series_11_d.jpg', 'images/semantic/semantic_series_10/semantic_series_10_d.jpg');
var show_fourth_image_12 = createFourthImageTrial('images/causal/causal_series_12/causal_series_12_d.jpg', 'images/semantic/semantic_series_11/semantic_series_11_d.jpg');
var show_fourth_image_13 = createFourthImageTrial('images/causal/causal_series_13/causal_series_13_d.jpg', 'images/semantic/semantic_series_12/semantic_series_12_d.jpg');
var show_fourth_image_14 = createFourthImageTrial('images/causal/causal_series_14/causal_series_14_d.jpg', 'images/semantic/semantic_series_13/semantic_series_13_d.jpg');
var show_fourth_image_15 = createFourthImageTrial('images/causal/causal_series_15/causal_series_15_d.jpg', 'images/semantic/semantic_series_14/semantic_series_14_d.jpg');
var show_fourth_image_16 = createFourthImageTrial('images/causal/causal_series_16/causal_series_16_d.jpg', 'images/semantic/semantic_series_15/semantic_series_15_d.jpg');
var show_fourth_image_17 = createFourthImageTrial('images/causal/causal_series_17/causal_series_17_d.jpg', 'images/semantic/semantic_series_16/semantic_series_16_d.jpg');
var show_fourth_image_18 = createFourthImageTrial('images/causal/causal_series_18/causal_series_18_d.jpg', 'images/semantic/semantic_series_17/semantic_series_17_d.jpg');


// Shuffle array function
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// Define the causal blocks
var causal_blocks = [
  [...first_three_causal_1, choose_next_image, show_fourth_image_1, ...clean_deck],
  [...first_three_causal_2, choose_next_image, show_fourth_image_2, ...clean_deck],
  [...first_three_causal_3, choose_next_image, show_fourth_image_3, ...clean_deck],
  [...first_three_causal_4, choose_next_image, show_fourth_image_4, ...clean_deck],
  [...first_three_causal_5, choose_next_image, show_fourth_image_5, ...clean_deck],
  [...first_three_causal_6, choose_next_image, show_fourth_image_6, ...clean_deck],
  [...first_three_causal_7, choose_next_image, show_fourth_image_7, ...clean_deck],
  [...first_three_causal_8, choose_next_image, show_fourth_image_8, ...clean_deck],
  [...first_three_causal_9, choose_next_image, show_fourth_image_9, ...clean_deck],
  [...first_three_causal_10, choose_next_image, show_fourth_image_10, ...clean_deck],
  [...first_three_causal_11, choose_next_image, show_fourth_image_11, ...clean_deck],
  [...first_three_causal_12, choose_next_image, show_fourth_image_12, ...clean_deck],
  [...first_three_causal_13, choose_next_image, show_fourth_image_13, ...clean_deck],
  [...first_three_causal_14, choose_next_image, show_fourth_image_14, ...clean_deck],
  [...first_three_causal_15, choose_next_image, show_fourth_image_15, ...clean_deck],
  [...first_three_causal_16, choose_next_image, show_fourth_image_16, ...clean_deck],
  [...first_three_causal_17, choose_next_image, show_fourth_image_17, ...clean_deck],
  [...first_three_causal_18, choose_next_image, show_fourth_image_18, ...clean_deck]
];

// Shuffle the causal blocks
var randomized_causal_blocks = shuffleArray(causal_blocks);

// Add the shuffled blocks to the timeline
randomized_causal_blocks.forEach(block => {
  timeline.push(...block);
});

   // Add other trials
// Trial 1: Ask if the participant can describe the difference between the two decks
var trial_difference_between_decks = {
  type: jsPsychSurveyText,
  questions: [
    {prompt: 'Can you describe the difference between the two decks of cards?'}
  ]
};

// Trial 2: Ask which deck seemed more interesting
var trial_interesting_deck = {
  type: jsPsychSurveyText,
  questions: [
    {prompt: 'Which deck seemed more interesting to you overall? (You can also say that both were interesting or neither was interesting)'}
  ]
};

// Trial: Ask which deck color the fourth image continues the story from the series
var trial_deck_color = {
  type: jsPsychHtmlButtonResponse,
      stimulus: 'Which color deck does the fourth image continue the story from the series?',
      choices: ['Blue', 'Red'],
};

// Trial: Ask which deck color the fourth image does not follow the story from the series
var trial_deck_color_not_following = {
  type: jsPsychHtmlButtonResponse,
      stimulus: 'Which color deck does the fourth image not follow the story from the series?',
      choices: ['Blue', 'Red'],
};



// Add the new trials to the timeline at the end
timeline.push(trial_difference_between_decks);
timeline.push(trial_interesting_deck);
timeline.push(trial_deck_color);
timeline.push(trial_deck_color_not_following);

// Add final questions (e.g., gender, age)
var trial_101 = {
  type: jsPsychSurveyText,
  questions: [
    {prompt: 'Please insert your gender (MALE/ FEMALE/ OTHER)'},
    {prompt: 'Please insert your age'}
  ]
};
timeline.push(trial_101);

// Final message
var trial_102 = {
  type: jsPsychInstructions,
  pages: [
    '<span style="color: black; font-size: 24px">You have completed the experiment.' + 
    '<br/>The completion code is : AJFHBG896<br/>Thank you for your participation!</span>'
  ],
  show_clickable_nav: true
};
timeline.push(trial_102);

// Run the experiment
jsPsych.run(timeline);

</script>
</html>

